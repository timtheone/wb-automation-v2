{
  "openapi": "3.1.0",
  "info": {
    "title": "WB Automation Backend API",
    "version": "0.1.0"
  },
  "tags": [
    {
      "name": "Health",
      "description": "Service health endpoints"
    },
    {
      "name": "Shops",
      "description": "Shop management endpoints"
    },
    {
      "name": "Flows",
      "description": "Automation flow endpoints"
    }
  ],
  "components": {
    "schemas": {
      "HealthResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "ok"
            ]
          },
          "service": {
            "type": "string",
            "enum": [
              "backend"
            ]
          }
        },
        "required": [
          "status",
          "service"
        ]
      },
      "ShopsResponse": {
        "type": "object",
        "properties": {
          "shops": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Shop"
            }
          }
        },
        "required": [
          "shops"
        ]
      },
      "Shop": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "wbToken": {
            "type": "string"
          },
          "wbSandboxToken": {
            "type": [
              "string",
              "null"
            ]
          },
          "useSandbox": {
            "type": "boolean"
          },
          "isActive": {
            "type": "boolean"
          },
          "supplyPrefix": {
            "type": "string"
          },
          "tokenUpdatedAt": {
            "type": "string",
            "format": "date-time"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "name",
          "wbToken",
          "wbSandboxToken",
          "useSandbox",
          "isActive",
          "supplyPrefix",
          "tokenUpdatedAt",
          "createdAt",
          "updatedAt"
        ]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string"
          },
          "details": {}
        },
        "required": [
          "error"
        ]
      },
      "ShopResponse": {
        "type": "object",
        "properties": {
          "shop": {
            "$ref": "#/components/schemas/Shop"
          }
        },
        "required": [
          "shop"
        ]
      },
      "CreateShopBody": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1
          },
          "wbToken": {
            "type": "string",
            "minLength": 1
          },
          "wbSandboxToken": {
            "type": [
              "string",
              "null"
            ],
            "minLength": 1
          },
          "useSandbox": {
            "type": "boolean"
          },
          "supplyPrefix": {
            "type": "string",
            "minLength": 1
          },
          "isActive": {
            "type": "boolean"
          }
        },
        "required": [
          "name",
          "wbToken"
        ]
      },
      "UpdateShopBody": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1
          },
          "wbSandboxToken": {
            "type": [
              "string",
              "null"
            ],
            "minLength": 1
          },
          "useSandbox": {
            "type": "boolean"
          },
          "supplyPrefix": {
            "type": "string",
            "minLength": 1
          },
          "isActive": {
            "type": "boolean"
          }
        }
      },
      "UpdateShopTokenBody": {
        "type": "object",
        "properties": {
          "wbToken": {
            "type": "string",
            "minLength": 1
          },
          "tokenType": {
            "type": "string",
            "enum": [
              "production",
              "sandbox"
            ]
          }
        },
        "required": [
          "wbToken"
        ]
      },
      "ProcessAllShopsResult": {
        "type": "object",
        "properties": {
          "startedAt": {
            "type": "string",
            "format": "date-time"
          },
          "finishedAt": {
            "type": "string",
            "format": "date-time"
          },
          "processedShops": {
            "type": "integer"
          },
          "successCount": {
            "type": "integer"
          },
          "skippedCount": {
            "type": "integer"
          },
          "failureCount": {
            "type": "integer"
          },
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ProcessAllShopsItem"
            }
          }
        },
        "required": [
          "startedAt",
          "finishedAt",
          "processedShops",
          "successCount",
          "skippedCount",
          "failureCount",
          "results"
        ]
      },
      "ProcessAllShopsItem": {
        "type": "object",
        "properties": {
          "shopId": {
            "type": "string"
          },
          "shopName": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": [
              "success",
              "skipped",
              "failed"
            ]
          },
          "supplyId": {
            "type": [
              "string",
              "null"
            ]
          },
          "ordersInNew": {
            "type": "integer"
          },
          "ordersSkippedByMeta": {
            "type": "integer"
          },
          "ordersAttached": {
            "type": "integer"
          },
          "barcode": {
            "type": [
              "string",
              "null"
            ]
          },
          "barcodeFile": {
            "type": [
              "string",
              "null"
            ]
          },
          "error": {
            "type": [
              "string",
              "null"
            ]
          }
        },
        "required": [
          "shopId",
          "shopName",
          "status",
          "supplyId",
          "ordersInNew",
          "ordersSkippedByMeta",
          "ordersAttached",
          "barcode",
          "barcodeFile",
          "error"
        ]
      },
      "SyncContentShopsResult": {
        "type": "object",
        "properties": {
          "startedAt": {
            "type": "string",
            "format": "date-time"
          },
          "finishedAt": {
            "type": "string",
            "format": "date-time"
          },
          "processedShops": {
            "type": "integer"
          },
          "successCount": {
            "type": "integer"
          },
          "failureCount": {
            "type": "integer"
          },
          "totalCardsUpserted": {
            "type": "integer"
          },
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SyncContentShopsItem"
            }
          }
        },
        "required": [
          "startedAt",
          "finishedAt",
          "processedShops",
          "successCount",
          "failureCount",
          "totalCardsUpserted",
          "results"
        ]
      },
      "SyncContentShopsItem": {
        "type": "object",
        "properties": {
          "shopId": {
            "type": "string"
          },
          "shopName": {
            "type": "string"
          },
          "pagesFetched": {
            "type": "integer"
          },
          "cardsUpserted": {
            "type": "integer"
          },
          "status": {
            "type": "string",
            "enum": [
              "success",
              "failed"
            ]
          },
          "error": {
            "type": [
              "string",
              "null"
            ]
          }
        },
        "required": [
          "shopId",
          "shopName",
          "pagesFetched",
          "cardsUpserted",
          "status",
          "error"
        ]
      },
      "NotImplementedResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string"
          }
        },
        "required": [
          "error"
        ]
      }
    },
    "parameters": {}
  },
  "paths": {
    "/health": {
      "get": {
        "tags": [
          "Health"
        ],
        "responses": {
          "200": {
            "description": "Service health status",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/shops": {
      "get": {
        "tags": [
          "Shops"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-chat-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "enum": [
                "private",
                "group",
                "supergroup",
                "channel"
              ]
            },
            "required": true,
            "name": "x-telegram-chat-type",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-user-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-owner-user-id",
            "in": "header"
          }
        ],
        "responses": {
          "200": {
            "description": "List shops",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ShopsResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Shops"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-chat-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "enum": [
                "private",
                "group",
                "supergroup",
                "channel"
              ]
            },
            "required": true,
            "name": "x-telegram-chat-type",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-user-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-owner-user-id",
            "in": "header"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateShopBody"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Shop created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ShopResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request body",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "409": {
            "description": "Shop name already exists",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/shops/{id}": {
      "patch": {
        "tags": [
          "Shops"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-chat-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "enum": [
                "private",
                "group",
                "supergroup",
                "channel"
              ]
            },
            "required": true,
            "name": "x-telegram-chat-type",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-user-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-owner-user-id",
            "in": "header"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateShopBody"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Shop updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ShopResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request body",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Shop not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Shops"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-chat-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "enum": [
                "private",
                "group",
                "supergroup",
                "channel"
              ]
            },
            "required": true,
            "name": "x-telegram-chat-type",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-user-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-owner-user-id",
            "in": "header"
          }
        ],
        "responses": {
          "200": {
            "description": "Shop deactivated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ShopResponse"
                }
              }
            }
          },
          "404": {
            "description": "Shop not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/shops/{id}/token": {
      "patch": {
        "tags": [
          "Shops"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-chat-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "enum": [
                "private",
                "group",
                "supergroup",
                "channel"
              ]
            },
            "required": true,
            "name": "x-telegram-chat-type",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-user-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-owner-user-id",
            "in": "header"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateShopTokenBody"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Shop token updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ShopResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request body",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Shop not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/flows/process-all-shops": {
      "post": {
        "tags": [
          "Flows"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-chat-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "enum": [
                "private",
                "group",
                "supergroup",
                "channel"
              ]
            },
            "required": true,
            "name": "x-telegram-chat-type",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-user-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-owner-user-id",
            "in": "header"
          }
        ],
        "responses": {
          "200": {
            "description": "Process all active shops",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProcessAllShopsResult"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/flows/sync-content-shops": {
      "post": {
        "tags": [
          "Flows"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-chat-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "enum": [
                "private",
                "group",
                "supergroup",
                "channel"
              ]
            },
            "required": true,
            "name": "x-telegram-chat-type",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-user-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-owner-user-id",
            "in": "header"
          }
        ],
        "responses": {
          "200": {
            "description": "Sync product cards for all active shops",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SyncContentShopsResult"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/flows/get-combined-pdf-lists": {
      "post": {
        "tags": [
          "Flows"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-chat-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "enum": [
                "private",
                "group",
                "supergroup",
                "channel"
              ]
            },
            "required": true,
            "name": "x-telegram-chat-type",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-user-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-owner-user-id",
            "in": "header"
          }
        ],
        "responses": {
          "501": {
            "description": "Flow is not implemented",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NotImplementedResponse"
                }
              }
            }
          }
        }
      }
    },
    "/flows/get-waiting-orders-pdf": {
      "post": {
        "tags": [
          "Flows"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-chat-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "enum": [
                "private",
                "group",
                "supergroup",
                "channel"
              ]
            },
            "required": true,
            "name": "x-telegram-chat-type",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-user-id",
            "in": "header"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^-?\\d+$"
            },
            "required": true,
            "name": "x-telegram-owner-user-id",
            "in": "header"
          }
        ],
        "responses": {
          "501": {
            "description": "Flow is not implemented",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NotImplementedResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "webhooks": {}
}
